<!DOCTYPE html>
<html lang="en">
  <head>
    <title>The Bender Data Model (v0.9, February 2014)</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="doc.css">
  </head>
  <body>
    <h1>The Bender Data Model</h1>
    <p>Version 0.9, February 2014</p>
    <p>See also <a href="processing-model.html">the Bender Processing Model</a>
    for reference.</p>

    <h2>Preliminaries</h2>
    <p>We use a loose notation to describe the data model of Bender in terms of
    objects and prototype, following the Javascript model.</p>
    <ul>
      <li>The data model is defined in terms of <em>Objects</em> and
      <em>data</em>. <code>Object</code>s are defined by their
      <em>properties</em>. A property has a name and a value, which may be any
      <code>data</code>: a boolean, a number, a string, a number, an
      <code>Object</code>, or the undefined value.</li>
      <li>A <em>Function</em> is a callable <code>Object</code>. We use lambda
      notation for anonymous functions. The pseudo-code used is a simple
      expression-based language with a liberal syntax that allows side
      effects (functions may not return any value.)</li>
      <li><em>O</em> <code>&lt;</code> <em>P</em> means that the object
      <em>O</em> is <em>created</em> from the object <em>P</em>. <em>O</em>
      inherits all of the properties of <em>P</em>, along with their values.
      <em>O</em> may have additional properties, and may override any property
      of <em>P</em>.</li>
      <li><code>?</code> means that the property may be undefined.</li>
      <li><code>*</code> means a list of zero or more objects.</li>
      <li><code>+</code> means a list of one or more objects.</li>
      <li><code>=</code> means that the object property on the left-hand side
      has a default value, defined on the right-hand side.</li>
      <li><code>[]</code> means an empty list.</li>
      <li><code>"..."</code> means a string (which can be considered as a list
      of characters.)</li>
      <li><em>L</em> <code>:</code> <em>x</em> means appending <em>x</em> to the
      list <em>L</em>.</li>
      <li><code>::</code> is the concatenation of two lists.</li>
    </ul>


    <h2>Nodes</h2>

    <div class="def" id="Node">
      <p>The Bender data model deals with two kinds of tree structures: trees
      of <em>components</em>, defining the high-level structure of a Bender
      application; and trees of <em>elements</em>, defining the contents and
      layout of a given component. Both trees are defined by tree
      <code>Node</code>s.</p>
      <div>
        <pre>Node &lt; Object:
  Node?    parent
  Node*    children
  string?  id</pre>
        <ul>
          <li><code>parent</code> is the parent node, if any, of the node. If a
          node has no parent, then it is the root of a tree.</li>
          <li><code>children</code> is the ordered list of child nodes of the
          node.</li>
          <li><code>id</code> is an optional string identifier. The identifier
          must be unique within a <em>scope</em>. The special value
          <code>this</code> is reserved to point to the current component.</li>
        </ul>
      </div>
    </div>


    <h2>Components</h2>

    <div class="def" id="Component">
      <p>The <code>Component</code> is the basic unit of functionality in
      Bender. Component are defined in terms of other components, both through
      <em>composition</em> (a component may contain child components) and
      <em>derivation</em> (a derived component is created from another
      component.)</p>
      <p>A <em>top-level component</em> is a component that has no
      <code>parent</code>, <em>i.e.</em>, the root of a component tree. There is
      no specific “application” type in Bender; an application is just a
      top-level component.</p>
      <div>
        <pre>Component &lt; Node:
  Component?  prototype
  Property*   property-definitions
  data*       properties
  View        view
  Watch*      watches</pre>
        <ul>
          <li><code>prototype</code> is the <code>Component</code>
          from which this component is derived, if any. The prototype may not
          be a component in the same component tree, nor can there be any cycle
          in the chain of components.</li>
          <li><code>property-definitions</code> is the list of all property
          definitions for this component. This includes the property definitions
          of the prototype component, or no property by default. Properties are
          indexed by their name.</li>
          <li><code>properties</code> is the list of all property values for
          this component, indexed by their name.</li>
          <li><code>view</code> is the root of the view tree of this
          component.</li>
          <li><code>watches</code> is the unordered list of all
          <code>Watch</code>es of the component.</li>
        </ul>
      </div>
    </div>


    <h2>Properties</h2>

    <p>Properties are named values that are used to parametrize both the
    appearance and behavior of a component. A property value may be any
    <code>data</code>.</p>

    <div class="def" id="Adapter">
      <p>An <code>Adapter</code> filters and transforms an input value into an
      output value, with an optional delay.</p>
      <div>
        <pre>Adapter &lt; Object:
  string    select = <span class="TODO">"@this"</span>
  Function  value = λx x
  Function  match = λx true
  number?   delay</pre>
        <ul>
          <li><code>select</code> indicates which component this adapter applies
          to. See <a href="processing-model.html">the Bender Processing
            model</a> for more information about the values of
          <code>select</code>.</li>
          <li><code>value</code> is a function transforming an input value into
          an output value. The default is the identity function, which returns
          its input.</li>
          <li><code>match</code> is a predicate that takes an input value and
          returns a boolean value that is true if and only if the input is
          <em>valid</em>. If an input is invalid, no value is output by the
          adapter. The default is a function that returns true for any input,
          treating any input value as valid.</li>
          <li><code>delay</code> is the delay before an output value is
          returned. When <code>delay</code> is undefined, there is no delay, and
          the output value is returned synchronously. When <code>delay</code> is
          0, then the output value is returned as soon as possible, but
          asynchronously. When <code>delay</code> is larger than 0, then this is
          the delay in milliseconds before which an output value is
          returned.</li>
        </ul>
      </div>
    </div>

    <div class="def" id="Property">
      <p>A <code>Property</code> is the <em>definition</em> of a property of a
      Bender component.</p>
      <div>
        <pre>Property &lt; Adapter:
  Component  component
  string     name</pre>
      </div>
      <ul>
        <li><code>component</code> points back to the component that this is a
        property of.</li>
        <li><code>name</code> is the name of the property. In that sense, a
        property definition is simply a named adapter belonging to a
        component.</li>
        <li><span class="TODO"><strong>Note</strong>: the <code>select</code>
          property, inherited from <code>Adapter</code>, has only two legal
          values for <code>Property</code>; <code>@this</code>,
          and <code>#this</code>.</span></li>
      </ul>
    </div>


    <h2>View and elements</h2>

    <p>The view of a component describes its contents as a tree of
    <code>Element</code>s. These elements describe how a component is
    rendered and which other components it contains with.</p>

    <div class="def" id="Element">
      <p><code>Element</code>s are <code>Node</code>s describing the view of a
      <code>Component</code>.</p>
      <div>
        <pre>Element &lt; Node:
  Component  component</pre>
        <ul>
          <li><code>component</code> is the <code>Component</code> that the
          element is in the view of. Except for <code>View</code>, this is the
          <code>component</code> of the closest <code>View</code> ancestor
          element.</li>
        </ul>
      </div>
    </div>

    <div class="def" id="View">
      <p>The <code>View</code> element is a container for the view of a
      component.</p>
      <div>
        <pre>View &lt; Element</pre>
        <ul>
          <li><strong>Note</strong>: for a <code>View</code> <em>V</em>,
          <code>component</code> is the <code>Component</code> <em>C</em> such
          that <code>C.view</code> is <em>V</em>. Additionally, if <em>V</em>
          has a <code>parent</code>, then there exists a component <em>P</em>
          such that <code>V.parent.component</code> is <em>P</em>, and
          <code>C.parent</code> is <em>P</em>.</li>
        </ul>
      </div>
    </div>

    <div class="def" id="Content">
      <p>The <code>Content</code> element provides an extension point for the
      view of derived components.</p>
      <div>
        <pre>Content &lt; Element</pre>
        <ul>
          <li><strong>Note</strong>: the <code>children</code> of a
          <code>Content</code> element are the default contents for the
          element.</li>
        </ul>
      </div>
    </div>

    <div class="def" id="DOMElement">
      <p>The <code>DOMElement</code> element represents a foreign element. Its
      properties map to properties of DOM elements.</p>
      <div>
        <pre>DOMElement &lt; Element
  string  ns
  string  name
  data*   attrs</pre>
        <ul>
          <li><code>ns</code> is the namespace URI of the DOM element.</li>
          <li><code>name</code> is the local name of the DOM element.</li>
          <li><code>attrs</code> is a list of attribute values of the DOM
          element, indexed first by namespace URI, then by local name.</li>
        </ul>
      </div>
    </div>

    <div class="def" id="Attribute">
      <p>The <code>Attribute</code> element represents an attribute of its
      parent element, similarly to a DOM attribute node.</p>
      <div>
        <pre>Attribute &lt; Element
  string  ns
  string  name</pre>
        <ul>
          <li><code>ns</code> is the namespace URI of the attribute.</li>
          <li><code>name</code> is the local name of the attribute.</li>
          <li><strong>Note</strong>: the value of the attribute is defined by
          the concatenation of the <code>text</code> of its <code>Text</code>
          child elements.</li>
        </ul>
      </div>
    </div>

    <div class="def" id="Text">
      <p>The <code>Text</code> element represents a text node, similarly to a
      DOM text node or CDATA section. Contrary to DOM text nodes,
      <code>Text</code> elements may have an ID.</p>
      <div>
        <pre>Text &lt; Element
  string  text</pre>
        <ul>
          <li><code>text</code> is the text content of the element.</li>
          <li><strong>Note</strong>: a <code>Text</code> element should not
          have children.</li>
        </ul>
      </div>
    </div>


    <h2>Watches</h2>
    <p>Watches describe the behavior of a component. A watch generalizes the
    concept of the event listener by allowing components to listen to event
    notifications from rendered elements (<em>e.g.</em>, DOM events), event
    notifications from components, and property changes from components; and
    associating these observations with corresponding actions, such as
    generating new event notifications, setting new values for properties, or
    mutating a component.</p>

    <h3>Watch</h3>

    <div class="def" id="Watch">
      <p>A <code>Watch</code> has <em>inputs</em> (incoming event notifications
      or property changes) and <em>outputs</em> (outgoing event notifications,
      property changes, or mutations.)</p>
      <div>
        <pre>Watch &lt; Object:
  Component  component
  Get*       gets
  Set*       sets</pre>
        <ul>
          <li><code>component</code> is the parent <code>Component</code> of
          this watch.</li>
          <li><code>gets</code> is the unordered list of <code>Get</code>s
          (inputs) of this watch.</li>
          <li><code>sets</code> is the unordered list of <code>Set</code>s
          (outputs) of this watch.</li>
        </ul>
      </div>
    </div>


    <h3>Get</h3>

    <div class="def" id="Get">
      <p>A <code>Get</code> is a watch input. There are two different types of
      input: a <em>property input</em>, or an <em>event input</em>.</p>
      <div>
        <pre>Get &lt; Adapter:
  Watch  watch</pre>
        <ul>
          <li><code>watch</code> is the parent <code>Watch</code>.</li>
        </ul>
      </div>
    </div>

    <div class="def" id="GetProperty">
      <p>A <code>GetProperty</code> is a property input.</p>
      <div>
        <pre>GetProperty &lt; Get:
  string  name</pre>
        <ul>
          <li><code>name</code> is the name of the <code>Property</code> that is
          monitored.</li>
          <li><strong>Note</strong>: <code>select</code> should point to a
          <code>Component</code> for which the property named <code>name</code>
          is defined.</li>
        </ul>
      </div>
    </div>

    <div class="def" id="GetEvent">
      <p>A <code>GetEvent</code> is an event input.</p>
      <div>
        <pre>GetEvent &lt; Get:
  string  type</pre>
        <ul>
          <li><code>type</code> is the type of the event that is being listened
          to.</li>
          <li><strong>Note</strong>: <code>select</code> should point to a
          <code>Component</code> or a <code>DOMElement</code>.
          <code>type</code> is then interpreted as the type of a Bender or
          DOM event (respectively.)</li>
        </ul>
      </div>
    </div>


    <h3>Set</h3>

    <div class="def" id="Set">
      <p>A <code>Set</code> is a watch output. There are four different types
      of output: a plain output, a property output, an attribute output, or an
      event output.</p>
      <div>
        <pre>Set &lt; Adapter:
  Watch  watch</pre>
        <ul>
          <li><code>watch</code> is the parent <code>Watch</code>.</li>
          <li><strong>Note</strong>: this is a <em>plain</em> output and is used
          for side effects only, such as mutating the contents of a
          component.</li>
        </ul>
      </div>
    </div>

    <div class="def" id="SetProperty">
      <p>A <code>SetProperty</code> is a property output.</p>
      <div>
        <pre>SetProperty &lt; Set:
  string  name</pre>
        <ul>
          <li><code>name</code> is the name of the property to be set. Note that
          “property” here means something different depending on the target
          designated by <code>select</code>:
          <ul>
            <li>if the target is a <code>DOMElement</code>, then the property is
            a DOM property (<em>e.g.</em>, <code>value</code> for an HTML text
            input element);</li>
            <li>if the target is a <code>Text</code> element, then the only
            valid value for <code>name</code> is <code>text</code>, in which
            case the text of the element is set;</li>
            <li>if the target is a <code>Component</code>, then the property is
            <code>Property</code> of the component.</li>
          </ul>
        </ul>
      </div>
    </div>

    <div class="def" id="SetAttribute">
      <p>A <code>SetAttribute</code> is an attribute output.</p>
      <div>
        <pre>SetAttribute &lt; Set:
  string?  ns
  string   name</pre>
        <ul>
          <li><code>ns</code> is the namespace URI of the attribute to
          set.</li>
          <li><code>name</code> is the local name of the attribute to set.</li>
          <li><strong>Note</strong>: <code>select</code> should designate a
          <code>DOMElement</code>.</li>
        </ul>
      </div>
    </div>

    <div class="def" id="SetEvent">
      <p>A <code>SetEvent</code> is an event output.</p>
      <div>
        <pre>SetEvent &lt; Set:
  string  type</pre>
        <ul>
          <li><code>type</code> is the type of the event to generate. If
          <code>select</code> points to a <code>DOMElement</code>, then a DOM
          event is synthesized. Otherwise, a Bender event notification is
          generated.</li>
        </ul>
      </div>
    </div>

    <h2>Two example components</h2>
    <p><span class="TODO">Describe the data model for these two
      components.</span></p>

    <div class="def" id="Button">
      <p>An HTML button component with a <code>label</code> string property. The
      value of the label property is displayed as the label of the button. The
      button is rendered as an HTML <code>div</code> element. When this element
      receives a mouse <code>click</code> DOM event, the button sends a
      <code>pushed</code> notification.</p>
      <div>
        <pre>&lt;component xmlns="http://bender.igel.co.jp" id="button"&gt;
  &lt;property name="label" value="Label"&gt;
  &lt;view xmlns:html="http://www.w3.org/1999/xhtml"&gt;
    &lt;html:div id="frame"&gt;
      &lt;content&gt;
        &lt;text id="text-label"/&gt;
      &lt;/content&gt;
    &lt;/html:div&gt;
  &lt;/view&gt;
  &lt;watch&gt;
    &lt;get property="label"/&gt;
    &lt;set select="@text-label"/&gt;
  &lt;/watch&gt;
  &lt;watch&gt;
    &lt;get select="@frame" event="click"/&gt;
    &lt;set event="pushed"/&gt;
  &lt;/watch&gt;
&lt;/component&gt;</pre>
      </div>
    </div>

    <div class="def" id="Panel">
      <p>A panel component, using three <code>Button</code>s as defined
      above. The first button reuses the view and default properties of the
      <code>Button</code> component. The second button sets its own
      <code>label</code> property. The third button has additional content in
      its view.</p>
      <div>
        <pre>&lt;component xmlns="http://bender.igel.co.jp" id="panel"&gt;
  &lt;view xmlns:html="http://www.w3.org/1999/xhtml"&gt;
    &lt;html:div&gt;
      &lt;component href="button.xml" id="ok-button"/&gt;
      &lt;component href="button.xml" id="retry-button" label="retry"/&gt;
      &lt;component href="button.xml" id="cancel-button"&gt;
        &lt;view&gt;
          &lt;html:span style="color: red"&gt;Cancel&lt;/html:span&gt;
        &lt;/view&gt;
      &lt;/component&gt;
    &lt;/html:div&gt;
  &lt;/view&gt;
  &lt;watch&gt;
    &lt;get select="@ok-button" event="pushed"/&gt;
    &lt;set .../&gt;
  &lt;/watch&gt;
  ...
&lt;/component&gt;</pre>
      </div>
    </div>

  </body>
</html>
