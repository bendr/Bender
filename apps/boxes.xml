<app xmlns="http://bender.igel.co.jp"
  xmlns:b="http://bender.igel.co.jp/b"
  xmlns:e="http://bender.igel.co.jp/e"
  xmlns:f="http://bender.igel.co.jp/f"
  xmlns:html="http://www.w3.org/1999/xhtml"
  xmlns:svg="http://www.w3.org/2000/svg">

  <title>Boxes</title>

  <component id="box">
    <stylesheet>
      .box { position: absolute; width: 300px; height: 150px;
        background-color: #08f; }
    </stylesheet>
    <view>
      <html:div id="box" class="box"/>
    </view>
    <watch>
      <get view="box" dom-event="mousedown" value="e">
        if (e.button === 0) {
          e.preventDefault();
          var p = flexo.event_client_pos(e);
          this.__moving = { target: target, x: p.x - target.offsetLeft,
            y: p.y - target.offsetTop,
            max_x: target.offsetParent.offsetWidth - target.offsetWidth,
            max_y: target.offsetParent.offsetHeight - target.offsetHeight };
          flexo.log(this.__moving)
          return e;
        }
      </get>
      <watch>
        <get dom-event="mousemove" value="e">
          var p = flexo.event_client_pos(e);
          this.__moving.target.style.left = "{0}px"
            .fmt(flexo.clamp(p.x - this.__moving.x, 0, this.__moving.max_x));
          this.__moving.target.style.top = "{0}px"
            .fmt(flexo.clamp(p.y - this.__moving.y, 0, this.__moving.max_y));
        </get>
        <get dom-event="mouseup" disable="true">
          delete this.__moving;
          return false;
        </get>
      </watch>
    </watch>
  </component>

  <stylesheet>
    html, body { height: 100%; margin: 0 }
    .workspace { width: 400px; height: 400px; margin: 20px 40px;
      background-color: #8f0; position: relative; }
    .box { position: absolute; width: 300px; height: 150px;
      background-color: #08f; }
  </stylesheet>

  <view>
    <html:div class="workspace">
      <use href="#box"/>
    </html:div>
  </view>

</app>
