<component xmlns="http://bender.igel.co.jp" id="websocket">
  <property name="ws" select="$that">
    return new WebSocket("ws://10.16.154.2:80/");
  </property>
  <property name="pin" as="number"/>
  <property name="msg" as="string" value="(none)"/>
  <property name="status" as="string" value="not connected"/>
  <view xmlns:html="http://www.w3.org/1999/xhtml">
    <html:p>WS: `(status) — last message on pin #`pin: `msg</html:p>
  </view>
  <watch>
    <get property="ws" dom-event="open"/>
    <set property="status" as="string" value="open"/>
  </watch>
  <watch>
    <get property="ws" dom-event="close"/>
    <set property="status" as="string" value="closed"/>
  </watch>
  <watch>
    <get property="ws" dom-event="error"/>
    <set property="status">
      console.log($in);
      return "error";
    </set>
  </watch>
  <watch>
    <get property="ws" dom-event="message">
      var data = $in.data.split(".");
      flexo.fail(!data);
      debugger;
      return { value: data[0], pin: flexo.to_number(data[1]) };
    </get>
    <set property="msg" value="flexo.fail($in.pin !== `pin) || $in.value"/>
  </watch>
</component>
