<component xmlns="http://bender.igel.co.jp" id="websocket">
  <!--<property name="uri" select="$that" as="string" value="ws://10.16.154.2/"/>-->
  <property name="ws" select="$that">
    return new WebSocket("ws://127.0.0.1:6455/");
  </property>
  <property name="pin" as="number"/>
  <property name="msg" as="string" value="(none)"/>
  <property name="status" as="string" value="not connected"/>
  <view xmlns:html="http://www.w3.org/1999/xhtml">
    <html:p>
      WS: `(status) — last message on pin #`pin: `msg
      <component href="../lib/button.xml" id="on-button">
        <view>
          ON
        </view>
      </component>
      <component href="../lib/button.xml" id="off-button">
        <view>
          OFF
        </view>
      </component>
    </html:p>
  </view>
  <watch>
    <get property="ws" dom-event="open"/>
    <set property="status" as="string" value="open"/>
  </watch>
  <watch>
    <get property="ws" dom-event="close"/>
    <set property="status" as="string" value="closed"/>
  </watch>
  <watch>
    <get property="ws" dom-event="error"/>
    <set property="status">
      console.log($in);
      return "error";
    </set>
  </watch>
  <watch>
    <get property="ws" dom-event="message">
      console.log("Received: %0".fmt($in));
      var data = $in.data.split(".");
      flexo.fail(!data);
      return { value: data[0], pin: flexo.to_number(data[1]) };
    </get>
    <set property="msg" value="flexo.fail($in.pin !== `pin) || $in.value"/>
  </watch>
  <watch>
    <get select="@on-button" event="pushed">
      console.log("%0.255.true".fmt(`pin));
      `ws.send("%0.255.true".fmt(`pin));
    </get>
  </watch>
  <watch>
    <get select="@off-button" event="pushed">
      console.log("%0.0.false".fmt(`pin));
      `ws.send("%0.0.false".fmt(`pin));
    </get>
  </watch>
</component>
