<app xmlns="http://bender.igel.co.jp" xmlns:html="http://www.w3.org/1999/xhtml">
  <title>Inline button component test</title>

  <component xmlns="http://bender.igel.co.jp"
    xmlns:html="http://www.w3.org/1999/xhtml" id="button">
    <title>A button component that responds to both mouse and touch
      events</title>
    <stylesheet>
      .bender-button { display: inline-block; cursor: default; padding: 4px;
        border: solid thin black; background-color: #ddd; }
      .bender-button.__down { opacity: 0.5; }
    </stylesheet>
    <controller>
      <script>
        $_.handleEvent = function(e)
        {
          e.preventDefault();
          if (e.type === "mousedown" || e.type === "touchstart") {
            flexo.add_class(this.outlets.button, "__down");
          } else if (e.type === "mouseup" || e.type === "touchend") {
            if (flexo.remove_class(this.outlets.button, "__down")) {
              setTimeout((function() { this.notify("@pushed"); }).bind(this),
                0);
            }
          } else if (e.type === "mouseout" || e.type === "touchcancel") {
            flexo.remove_class(this.outlets.button, "__down");
          }
        };
      </script>
      <connect outlet="button" target="b"/>
      <listen dom-event="mousedown" source="b"/>
      <listen dom-event="mouseout" source="b"/>
      <listen dom-event="mouseup" source="b"/>
      <listen dom-event="touchstart" source="b"/>
      <listen dom-event="touchend" source="b"/>
      <listen dom-event="touchcancel" source="b"/>
    </controller>
    <root-view>
      <html:div class="bender-button" id="b"><content/></html:div>
    </root-view>
  </component>

  <controller>
    <listen source="ok-button" event="@pushed">alert("OK");</listen>
  </controller>

  <view>
    <html:p>
      Click this button: <component ref="button" id="ok-button">OK</component>
    </html:p>
  </view>

</app>
