<app xmlns="http://bender.igel.co.jp" xmlns:b="http://bender.igel.co.jp/b"
  xmlns:svg="http://www.w3.org/2000/svg">
  <title>SVG Button component test</title>

  <component id="svg-button" b:enabled="true">
    <view>
      <svg:rect id="rect" width="100" height="100"/>
    </view>

    <watch>
      <get property="enabled"/>
      <set view="rect" attr="fill">
        return value ? "#08f" : "#ccc";
      </set>
    </watch>

    <watch>
      <get view="rect" dom-event="mousedown"/>
      <get view="rect" dom-event="touchstart"/>
      <set>
        if (this.enabled) {
          this.views.rect.setAttribute("fill", "#f80");
          this.__down = true;
        }
      </set>
      <watch>
        <get view="rect" dom-event="mouseup"/>
        <get view="rect" dom-event="touchend"/>
        <set>
          if (this.__down) {
            this.views.rect.setAttribute("fill", "#08f");
            setTimeout((function() { bender.notify(this, "@pushed") })
                .bind(this), 0);
            delete this.__down;
          }
        </set>
      </watch>
      <watch>
        <get view="rect" dom-event="mouseout"/>
        <get view="rect" dom-event="touchcancel"/>
        <set>
          if (this.__down) {
            this.views.rect.setAttribute("fill", "#08f");
            delete this.__down;
          }
        </set>
      </watch>
    </watch>
  </component>

  <view>
    <component ref="svg-button" id="button"/>
  </view>

  <watch>
    <get view="button" event="@pushed">
      alert("button was pushed!");
    </get>
  </watch>

</app>
