<component xmlns="http://bender.igel.co.jp" xmlns:b="http://bender.igel.co.jp/b"
  xmlns:f="http://bender.igel.co.jp/f" xmlns:e="http://bender.igel.co.jp/e"
  f:x="0" f:y="0" b:locked="false">

  <title>Movable Component</title>

  <view>
    <content content-id="moving"/>
  </view>

  <watch>
    <get use="$self" property="x">
      this.views.moving.style.left = "{0}px".fmt(value);
    </get>
    <get use="$self" property="y">
      this.views.moving.style.top = "{0}px".fmt(value);
    </get>
  </watch>

  <watch>
    <get use="$self" event="@rendered">
      this.views.moving.classList.add("__movable");
    </get>
  </watch>

  <watch>
    <get view="moving" event="mousedown"><![CDATA[
      if (value.button === 0 && !this.properties.locked) {
        value.preventDefault();
        this.views.moving.classList.add("__moving");
        var p = flexo.event_client_pos(value);
        this.__offset = { x: p.x - this.properties.x,
          y: p.y - this.properties.y };
      }
    ]]></get>
    <get view="$document" event="mousemove">
      if (this.__offset) {
        var p = flexo.event_client_pos(value);
        this.properties.x = p.x - this.__offset.x;
        this.properties.y = p.y - this.__offset.y;
      }
    </get>
    <get view="$document" event="mouseup">
      this.views.moving.classList.remove("__moving");
      delete this.__offset;
    </get>
  </watch>

</component>
