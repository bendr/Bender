<component xmlns="http://bender.igel.co.jp"
  xmlns:b="http://bender.igel.co.jp/b" b:resizable="true"
  xmlns:html="http://www.w3.org/1999/xhtml"
  xmlns:svg="http://www.w3.org/2000/svg">

  <title>Resizable Component</title>

  <view>
    <html:div style="position: relative; display: inline-block">
      <content content-id="resizing"/>
      <use ref="resizer" id="resizer"/>
    </html:div>
  </view>

  <watch>
    <get use="$self" event="@rendered"/>
    <set use="$self" property="w">
      return this.views.resizing.offsetWidth;
    </set>
    <set use="$self" property="h">
      return this.views.resizing.offsetHeight;
    </set>
  </watch>

  <watch>
    <get use="$self" property="w">
      this.views.resizing.style.width = "{0}px".fmt(value);
    </get>
    <get use="$self" property="h">
      this.views.resizing.style.height = "{0}px".fmt(value);
    </get>
  </watch>

  <watch>
    <get use="resizer" event="@resize">
      this.__offset = flexo.event_client_pos(value.event);
    </get>
    <get view="$document" event="mousemove">
      if (this.__offset) {
        var p = flexo.event_client_pos(value);
        this.properties.w += p.x - this.__offset.x;
        this.properties.h += p.y - this.__offset.y;
        this.__offset = p;
      }
    </get>
    <get view="$document" event="mouseup">
      delete this.__offset;
    </get>
  </watch>

  <component id="resizer">
    <view>
      <svg:svg viewBox="0 0 16 16" width="16" height="16"
        style="position: absolute; right: 0; bottom: 0">
        <svg:line x1="0" y1="16" x2="16" y2="0" stroke="white"/>
        <svg:line x1="1" y1="16" x2="16" y2="1" stroke="black"/>
        <svg:line x1="4" y1="16" x2="16" y2="4" stroke="white"/>
        <svg:line x1="5" y1="16" x2="16" y2="5" stroke="black"/>
        <svg:line x1="8" y1="16" x2="16" y2="8" stroke="white"/>
        <svg:line x1="9" y1="16" x2="16" y2="9" stroke="black"/>
        <svg:line x1="12" y1="16" x2="16" y2="12" stroke="white"/>
        <svg:line x1="13" y1="16" x2="16" y2="13" stroke="black"/>
        <svg:rect id="target" width="16" height="16" fill-opacity="0"/>
      </svg:svg>
    </view>
    <watch>
      <get view="target" event="mousedown"><![CDATA[
        if (value.button === 0 && !this.properties.locked) {
          value.preventDefault();
          flexo.notify(this, "@resize", { event: value });
        }
      ]]></get>
    </watch>
  </component>

</component>
