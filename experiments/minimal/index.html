<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Bender a minima</title>
    <meta charset="UTF-8">
    <style>
body {
  font-family: "Avenir Next", Avenir, "Helvetica Neue", Helvetica, sans-serif;
}

a {
  text-decoration: none;
  color: #ff4040;
}

.button {
  display: inline-block;
  margin: 0 0.5rem;
  min-width: 4rem;
  text-align: center;
  background-color: #ff4040;
  color: #f8f9f0;
  padding: 0.2rem;
  cursor: default;
}

.panel {
  padding: 1rem;
  border: solid thin black;
  margin: 1rem;
  display: inline-block;
}

.button.down {
  opacity: 0.5;
}

.button.disabled {
  background-color: #888 !important;
}
    </style>
    <script src="flexo.js"></script>
    <script src="core.js"></script>
    <script src="runtime.js"></script>
  </head>
  <body>
    <script>
"use strict";

/*
var text_roman = bender.Text.create();
var roman = bender.Component.create(bender.View.create()
    .child(bender.DOMElement.create(flexo.ns.html, "p")
      .child(bender.Text.create().text("n = "))
      .child(text_roman)))
  .name("Roman")
  .property("n", 123);
roman.watch(bender.Watch.create()
    .get(bender.GetProperty.create(roman, "n"))
    .set(bender.SetNodeProperty.create(text_roman, "text")));

var graph = roman.render();
*/

/*
var D = bender.Component.create(bender.View.create()
    .child(bender.DOMElement.create(flexo.ns.html, "h3")
      .child(bender.Text.create().text("D"))))
  .name("D");
var C = bender.Component.create(bender.View.create()
    .child(bender.DOMElement.create(flexo.ns.html, "h3")
      .child(bender.Text.create().text("C"))))
  .name("C");
var B = bender.Component.create(bender.View.create()
    .child(bender.DOMElement.create(flexo.ns.html, "h2")
      .child(bender.Text.create().text("B")))
    .child(C.view)
    .child(D.view))
  .name("B");
var B1 = B.create().name("B1");
var B2 = B.create().name("B2");
var A = bender.Component.create(bender.View.create()
    .child(bender.DOMElement.create(flexo.ns.html, "h1")
      .child(bender.Text.create().text("A")))
    .child(B1.view)
    .child(B2.view))
  .name(A);

A.render();

var hello = bender.Component.create(bender.View.create()
    .child(bender.DOMElement.create(flexo.ns.html, "p")
      .child(bender.Text.create().text("Hello, world!"))))
  .name("Hello");

hello.render();

*/

var text_label = bender.Text.create().name("text-label");
var frame = bender.DOMElement.create(flexo.ns.html, "div",
    { "": { "class": "button" } })
  .name("frame")
  .child(bender.Content.create().child(text_label));
var button = bender.Component.create(bender.View.create().child(frame))
  .name("Button")
  .property("label", "OK")
  .property("enabled", true)
  .property("down", false);

button.watch(bender.Watch.create()  // 4
      .get(bender.GetProperty.create(button, "label"))
      .set(bender.SetNodeProperty.create(text_label, "text")))
  .watch(bender.Watch.create()  // 5
      .get(bender.GetEvent.create(frame, "mousedown")
        .prevent_default(true))
      .set(bender.SetProperty.create(button, "down")
        .match(function () { return this.properties.enabled; })
        .value(flexo.funcify(true))))
  .watch(bender.Watch.create()  // 6
      .get(bender.GetEvent.create(frame, "mouseup"))
      .set(bender.SetEvent.create(button, "pushed")
        .match(function () { return this.properties.down; }))
      .set(bender.SetProperty.create(button, "down")
        .value(flexo.funcify(false))))
  .watch(bender.Watch.create()  // 7
      .get(bender.GetProperty.create(button, "down"))
      .get(bender.GetProperty.create(button, "enabled"))
      .set(bender.SetAttribute.create(frame, "", "class")
        .value(function () {
            return "button %0 %1".fmt(this.properties.down ? "down" : "",
              this.properties.enabled ? "" : "disabled");
          })));

var text_n = bender.Text.create().name("text-n");
var plus = button.create().name("Plus").property("label", "+");
var minus = button.create().name("Minus").property("label", "â€”");
var panel = bender.Component.create(bender.View.create()
    .child(bender.DOMElement.create(flexo.ns.html, "div",
        { "": { "class": "panel" } })
      .child(text_n)
      .child(plus.view)
      .child(minus.view)))
  .name("Panel")
  .property("n", 0);

panel.watch(bender.Watch.create()  // 1
      .get(bender.GetEvent.create(plus, "pushed"))
      .set(bender.SetProperty.create(panel, "n")
        .value(function () { return this.properties.n + 1; })))
  .watch(bender.Watch.create()  // 2
      .get(bender.GetEvent.create(minus, "pushed"))
      .set(bender.SetProperty.create(panel, "n")
        .value(function () { return this.properties.n - 1; })))
  .watch(bender.Watch.create()  // 3
      .get(bender.GetProperty.create(panel, "n"))
      .set(bender.SetNodeProperty.create(text_n, "text"))
      .set(bender.SetProperty.create(minus, "enabled")
        .value(function ($in) { return $in > 0; })));

panel.render().dump();

  /*
var p1 = panel.create().name("p1");
var p2 = panel.create().name("p2");
bender.Component.create(bender.View.create()
    .child(p1.view)
    .child(p2.view)).render().dump();
    */

    </script>
  </body>
</html>
