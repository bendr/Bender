<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Bender a minima</title>
    <meta charset="UTF-8">
    <style>
body {
  font-family: "Avenir Next", Avenir, "Helvetica Neue", Helvetica, sans-serif;
}

a {
  text-decoration: none;
  color: #ff4040;
}

.button {
  display: inline-block;
  margin: 0 0.5rem;
  min-width: 4rem;
  text-align: center;
  background-color: #ff4040;
  color: #f8f9f0;
  padding: 0.2rem;
  cursor: default;
}

.panel {
  padding: 1rem;
  border: solid thin black;
  margin: 1rem;
  display: inline-block;
}

.button.down {
  opacity: 0.5;
}

.button.disabled {
  background-color: #888 !important;
}
    </style>
    <script src="flexo.js"></script>
    <script src="core.js"></script>
    <script src="runtime.js"></script>
  </head>
  <body>
    <script>
"use strict";

var text_label = bender.Text.create().name("text-label");
var frame = bender.DOMElement.create(flexo.ns.html, "div",
    { "": { "class": "button" } })
  .name("frame")
  .child(bender.Content.create().child(text_label));
var button = bender.Component.create(bender.View.create().child(frame))
  .name("Button")
  .property("label", "OK")
  .property("enabled", true)
  .property("down", false);

button.watch(bender.Watch.create()  // 4
      .get(bender.GetProperty.create("label", button))
      .set(bender.SetNodeProperty.create("text", text_label)))
  .watch(bender.Watch.create()  // 5
      .get(bender.GetEvent.create("mousedown", frame)
        .prevent_default(true))
      .set(bender.SetProperty.create("down", button)
        .match(function () { return this.properties.enabled; })
        .value(flexo.funcify(true))))
  .watch(bender.Watch.create()  // 6
      .get(bender.GetEvent.create("mouseup", frame))
      .set(bender.SetEvent.create("pushed", button)
        // .delay(0)
        .match(function () { return this.properties.down; }))
      .set(bender.SetProperty.create("down", button)
        .value(flexo.funcify(false))))
  .watch(bender.Watch.create()  // 7
      .get(bender.GetProperty.create("down", button))
      .get(bender.GetProperty.create("enabled", button))
      .set(bender.SetAttribute.create("", "class", frame)
        .value(function () {
            return "button %0 %1".fmt(this.properties.down ? "down" : "",
              this.properties.enabled ? "" : "disabled");
          })));

var text_n = bender.Text.create().name("text-n");
var plus = button.create().name("Plus").property("label", "+");
var minus = button.create().name("Minus").property("label", "â€”");
var panel = bender.Component.create(bender.View.create()
    .child(bender.DOMElement.create(flexo.ns.html, "div",
        { "": { "class": "panel" } })
      .child(text_n)
      .child(plus.view)
      .child(minus.view)))
  .name("Panel")
  .property("n", 0);

panel.watch(bender.Watch.create()  // 1
      .get(bender.GetEvent.create("pushed", plus))
      .set(bender.SetProperty.create("n", panel)
        .value(function () { return this.properties.n + 1; })))
  .watch(bender.Watch.create()  // 2
      .get(bender.GetEvent.create("pushed", minus))
      .set(bender.SetProperty.create("n", panel)
        .value(function () { return this.properties.n - 1; })))
  .watch(bender.Watch.create()  // 3
      .get(bender.GetProperty.create("n", panel))
      .set(bender.SetNodeProperty.create("text", text_n))
      .set(bender.SetProperty.create("enabled", minus)
        .value(function ($in) { return $in > 0; })));

// panel.render().dump();

var p1 = panel.create().name("p1");
var p2 = panel.create().name("p2");
bender.Component.create(bender.View.create()
    .child(p1.view)
    .child(p2.view)).render().dump();

    </script>
  </body>
</html>
