<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Bender a minima</title>
    <meta charset="UTF-8">
    <style>
body {
  font-family: "Avenir Next", Avenir, "Helvetica Neue", Helvetica, sans-serif;
}

a {
  text-decoration: none;
  color: #ff4040;
}
    </style>
    <script src="flexo.js"></script>
    <script src="core.js"></script>
    <script src="runtime.js"></script>
  </head>
  <body>
    <script>
"use strict";

var text_label = bender.Text.create().name("text-label");
var frame = bender.DOMElement.create(flexo.ns.html, "div")
  .name("frame")
  .child(bender.Content.create().child(text_label));
var label = bender.Property.create("label");
var enabled = bender.Property.create("enabled");
var down = bender.Property.create("down");
var button = bender.Component.create(bender.View.create().child(frame))
  .name("Button")
  .property(label)
  .property(enabled)
  .property(down);
button.watch(bender.Watch.create()  // 4
      .get(bender.GetProperty.create(button, label))
      .set(bender.SetNodeProperty.create(text_label, "text")))
  .watch(bender.Watch.create()  // 5
      .get(bender.GetEvent.create(frame, "mousedown"))
      .set(bender.SetProperty.create(button, down)
        .match(function () { return this.properties.enabled; })
        .value(flexo.funcify(true))))
  .watch(bender.Watch.create()  // 6
      .get(bender.GetEvent.create(frame, "mouseup"))
      .set(bender.SetEvent.create(button, "pushed")
        .match(function () { return this.properties.down; }))
      .set(bender.SetProperty.create(button, down)
        .value(flexo.funcify(false))))
  .watch(bender.Watch.create()  // 7
      .get(bender.GetProperty.create(button, down))
      .set(bender.SetAttribute.create(frame, "", "class")
        .value(function ($in) { return $in ? "down" : ""; })))
  .watch(bender.Watch.create()  // 8
      .get(bender.GetProperty.create(button, enabled))
      .set(bender.SetAttribute.create(frame, "", "class")
        .value(function ($in) { return $in ? "" : "disabled"; })))

var n = bender.Property.create("n");
var text_n = bender.Text.create().name("text-n");
var plus = button.create().name("Plus");
var minus = button.create().name("Minus");
var panel = bender.Component.create(bender.View.create()
    .child(bender.DOMElement.create(flexo.ns.html, "div")
      .child(text_n)
      .child(plus.view)
      .child(minus.view)))
  .name("Panel")
  .property(n)
panel.watch(bender.Watch.create()  // 1
      .get(bender.GetEvent.create(plus, "pushed"))
      .set(bender.SetProperty.create(panel, n)
        .value(function () { return this.properties.n + 1; })))
  .watch(bender.Watch.create()  // 2
      .get(bender.GetEvent.create(minus, "pushed"))
      .set(bender.SetProperty.create(panel, n)
        .value(function () { return this.properties.n - 1; })))
  .watch(bender.Watch.create()  // 3
      .get(bender.GetProperty.create(panel, n))
      .set(bender.SetNodeProperty.create(text_n, "text"))
      .set(bender.SetProperty.create(minus, enabled)
        .value(function ($in) { return $in > 0; })));

var graph = bender.WatchGraph.create();
panel.render_subgraph(graph);
graph.sort().dump();

    </script>
  </body>
</html>
