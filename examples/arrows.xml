<app xmlns="http://bender.igel.co.jp" xmlns:svg="http://www.w3.org/2000/svg">

  <!-- TODO -->
  <!-- size is a parameter of the app, yet it is visible (throug lexical scope)
       in the arrow component: therefore all arrows have the same size. -->
  <!-- replicate the arrows in 2 dimensions -->

  <view>
    <svg:svg viewBox="0 0 200 200">
      <svg:g>
        <use href="#arrow" x="0" y="0" size="100"/>
        <use href="#arrow" x="100" y="0" size="100"/>
        <use href="#arrow" x="0" y="100" size="100"/>
        <use href="#arrow" x="100" y="100" size="100"/>
      </svg:g>
    </svg:svg>
  </view>

  <!-- An individual arrow that follows the mouse pointer -->
  <component id="arrow">
    <property name="x" type="number"/>
    <property name="y" type="number"/>
    <property name="a" type="dynamic" value="flexo.random_int(360)"/>
    <property name="size" type="number"/>
    <property name="color" type="dynamic"
      value="flexo.hsv_to_hex({a} * Math.PI / 180, 1, 1)"/>
    <view>
      <svg:g transform="translate({x}, {y}) scale({{{size} / 20}})
        rotate({a}, 10, 10)">
        <svg:line x1="2" y1="10" x2="14" y2="10" stroke="{color}"
          stroke-linecap="round"/>
        <svg:path d="M 18 10 L 13 7.5 L 13 12.5 z" fill="{color}"/>
      </svg:g>
    </view>
    <watch>
      <get view="$document" dom-event="mousemove"/>
      <set use="$self" property="a">
        var p = flexo.event_svg_point(value);
        if (p) {
          return Math.atan2(p.y - this.properties.y - this.properties.size / 2,
            p.x - this.properties.x - this.properties.size / 2) * 180 / Math.PI;
        }
      </set>
    </watch>
  </component>

</app>
