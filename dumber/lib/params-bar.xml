<component xmlns="http://dumber.igel.co.jp"
  xmlns:html="http://www.w3.org/1999/xhtml">
  <view>
    <target q="head" once="true">
      <html:style>
        .params-bar { background-color: black; color: white; padding: 4px; }
        .params-bar input { border: none; background-color: #ffd; }
        .params-bar input[type=number] { width: 4em; }
        .params-bar label { margin: 0 4px; }
        .params-bar a { display: inline-block; text-align: right;
          color: #ff4040; text-decoration: none; float: right; margin: 4px; }
      </html:style>
    </target>
    <html:div class="params-bar">
      ⚐
      <html:span/>
      <html:a href="../index.html">Home</html:a>
    </html:div>
  </view>
  <script>
    var div = this.querySelector("span");
    var watches = [];
    this._prototype.add_param = function(type, name, value)
    {
      flexo.log("+++ param {0}".fmt(name));
      div.appendChild(div.$("use", { ref: type, "e:name": name,
        "e:value": value, id: name }));
      watches.push(this.component.appendChild(this.component.$("watch",
        this.component.$get({ use: name, event: "@change" }, function(value) {
            flexo.notify(this, "@change", { name: name, value: value.value });
            return value;
          }),
        this.component.$("set", { use: "$self", property: name }))));
    };
    this._prototype.clear = function()
    {
      flexo.remove_children(div);
      watches.forEach(function(w) { flexo.safe_remove(w); });
      watches = [];
    };
  </script>

  <component id="e">
    <view>
      <html:label>
        <html:span id="label"/>: <html:input id="input" type="text"/>
      </html:label>
    </view>
    <watch>
      <get use="$self" property="name"/>
      <set view="label"/>
    </watch>
    <watch>
      <get use="$self" property="value"/>
      <set view="input" property="value"/>
    </watch>
    <watch>
      <get view="input" event="change">
        var val = this.views.input.value;
        flexo.notify(this, "@change", { value: val });
        return val;
      </get>
      <set use="$self" property="value"/>
    </watch>
  </component>

  <component id="f">
    <view>
      <html:label>
        <html:span id="label"/>: <html:input id="input" type="number"/>
      </html:label>
    </view>
    <watch>
      <get use="$self" property="name"/>
      <set view="label"/>
    </watch>
    <watch>
      <get use="$self" property="value"/>
      <set view="input" property="value"/>
    </watch>
    <watch>
      <get view="input" event="change">
        var val = this.views.input.value;
        flexo.notify(this, "@change", { value: parseFloat(val) });
        return val;
      </get>
      <set use="$self" property="value"/>
    </watch>
  </component>

  <component id="b">
    <view>
      <html:label>
        <html:input id="input" type="checkbox"/> <html:span id="label"/>
      </html:label>
    </view>
    <watch>
      <get use="$self" property="name"/>
      <set view="label"/>
    </watch>
    <watch>
      <get use="$self" property="value"/>
      <set view="input" property="checked"/>
    </watch>
    <watch>
      <get view="input" event="change">
        var val = this.views.input.checked;
        flexo.notify(this, "@change", { value: !!val });
        return val;
      </get>
      <set use="$self" property="value"/>
    </watch>
  </component>

</component>
