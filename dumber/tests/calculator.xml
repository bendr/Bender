<app xmlns="http://dumber.igel.co.jp" xmlns:html="http://www.w3.org/1999/xhtml">
  <title>Dymamic Calculator (w/ script)</title>

  <component id="button">
    <view>
      <target q="head" once="true">
        <html:style>
          .button { font-family: Futura, sans-serif; display: inline-block;
            cursor: default; background-color:#ddd; padding: 4px;
            -moz-border-radius: 6px; -webkit-border-radius: 6px;
            border-radius: 6px; box-shadow: 0px 1px 0px #bbb;
            text-shadow: 0px 1px 0px #fff; margin: 8px; }
        </html:style>
      </target>
      <html:div class="button" id="b">
        <content/>
      </html:div>
    </view>
    <watch>
      <get view="b" event="click">
        if (value.button === 0) flexo.notify(this, "@pushed");
      </get>
    </watch>
  </component>

  <view>
    <target q="head" once="true">
      <html:style>
        body { font-family: Futura, "Helvetica Neue", Helvetica, sans-serif;
          background-color: #888; }
        @font-face { font-family: "Digital7";
          src: url("../../apps/demos/digital-7.ttf"); font-weight: normal;
          font-style: normal; }
        .calculator { width: 412px; background-color: #fd0; padding: 24px;
          margin: 32px auto; -webkit-border-radius: 12px;
          -moz-border-radius: 12px; border-radius: 12px;
          box-shadow: 4px 4px 8px #444; }
        .screen { position: relative; text-align: right; margin-bottom: 32px;
          height: 96px; background-color: #b3cbb3; padding: 8px;
          box-shadow: inset 1px 1px 5px #444;
          text-shadow: 2px 2px 0px #9ebb9e;
          -webkit-border-radius: 8px; -moz-border-radius: 8px;
          overflow: hidden; text-overflow: ellipsis;
        }
        .value { font-size: 72px; font-family: Digital7, monospace; }
        .op { position: absolute; bottom: 8px; right: 8px; font-size: 36px; }
        .row { height: 88px; margin-top: 16px; position: relative; }
        .row .button { padding: 14px 0 0 0; margin: 0; width: 88px;
          height: 70px; text-align: center; font-size: 48px; position: absolute;
          box-shadow: 1px 1px 5px #444; }
        .row .button:nth-child(2) { left: 108px; }
        .row .button:nth-child(3) { left: 216px; }
        .row .button:nth-child(4) { left: 324px; }
        .button.tall { padding-top: 118px; }
        .button.wide { padding-right: 108px; }
      </html:style>
    </target>
    <html:div class="calculator">
      <html:div class="screen">
        <html:span class="value" id="value"/>
        <html:span class="op" id="op"/>
      </html:div>
    </html:div>
  </view>
  <script>
    var rows =
    [["C", "=", "÷", "×"], ["7", "8", "9", "−"],
      ["4", "5", "6", "+"], ["1", "2", "3", "=#tall button"],
      ["0#wide button", "", "."]];
    var body = this.querySelector(".calculator");
    rows.forEach(function(row) {
        var r = context.$("html:div.row");
        row.forEach(function(op) {
            var fields = op.split("#");
            if (fields[0]) {
              r.appendChild(context.$("use", { ref: "button",
                "class": fields[1] }, fields[0]));
            } else {
              r.appendChild(context.$("html:span"));
            }
          });
        body.appendChild(r);
      });

  </script>
</app>
